# Chapter 6. 테스트 코드의 구성

- [기능에서의 상황](#기능에서의-상황)
- [테스트 코드의 구성 요소: 상황, 실행, 결과 확인](#테스트-코드의-구성-요소:-상황,-실행,-결과-확인)
- [외부 상황과 외부 결과](#외부-상황과-외부-결과)

<br>

## 기능에서의 상황

* 기능은 주어진 상황에 따라 다르게 동작한다.

*예) 파일에서 숫자를 읽어와 합을 구한다.*  
* 파일이 없는 상황  
→ Exception을 발생시키거나 문제상황을 알려줄 값을 반환해야 함
* 숫자가 아닌 데이터가 존재하는 경우  
→ 알맞은 결과 생성

<br>

## 테스트 코드의 구성 요소: 상황, 실행, 결과 확인

given, when, then
* 상황
  * 각 테스트마다 상황을 설정
  * @BeforeEach와 같은 공통 처리단에서 상황을 설정
  * 상황이 없는 경우도 있음
* 실행
* 결과
  * 리턴 값
  * Exception

<br>

## 외부 상황과 외부 결과

* 테스트는 실행할 때마다 동일한 결과를 보장해야 한다.
* 상황에는 외부 요인도 있다. 외부 요인에 의해 테스트의 결과가 달라지면 안 된다.
  * 올바른 상황에서 동작한다는 것을 보장하는 코드 작성
  * 테스트 코드 내에서 상황을 구성
  * *예) 파일이 이미 존재하는 경우 테스트 코드에서 파일 삭제,  
  테스트 코드에서 상황에 맞는 파일을 생성*
* 실행 결과를 외부에서 확인해야 하는 경우도 있다.  

### 외부 상태가 테스트 결과에 영향을 주지 않게 하기

* 테스트 실행 전에 외부를 원하는 상태로 만들거나, 테스트 실행 후에 외부 상태를 원래대로 돌려놔야 한다.  
예) 생성 후 삭제, 롤백 등

### 외부 상태와 테스트 어려움

*예) 금융 회사에서 제공하는 REST API 사용 시, 자동이체 등록 기능*
* 유효한 계좌번호
* 유효하지 않은 계좌번호
* API 서버에 연결할 수 없는 상황
* 응답을 5초 이내에 받지 못하는 상황

<br>

* 테스트 대상이 아닌 외부 요인은 테스트 코드에서 다루기 힘들고, 제어할 수 없는 경우가 있다.
* 테스트 대상의 상황가 결과에 외부 요인이 있는 경우, 대역을 사용하여 테스트한다.
* `대역`: 테스트 대상이 의존하는 대상의 실제 구현을 대신하는 구현